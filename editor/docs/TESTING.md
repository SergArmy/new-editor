# Инструкция по тестированию

## Запуск приложения

1. **Установите зависимости** (если еще не установлены):
```bash
cd editor
npm install
```

2. **Запустите dev-сервер**:
```bash
npm run dev
```

3. **Откройте в браузере**:
```
http://localhost:5173/index.html
```

## Тестирование Drag & Drop

### Что проверить:

1. **Визуальные индикаторы**:
   - При наведении на блок курсор должен измениться на `grab` (рука)
   - При начале перетаскивания блок должен стать полупрозрачным (opacity: 0.5)
   - При перетаскивании над зоной вставки должна появиться цветная линия (акцентный цвет)

2. **Перетаскивание блоков**:
   - Зажмите левую кнопку мыши на любом блоке
   - Перетащите блок вверх или вниз
   - Отпустите кнопку мыши над зоной вставки (между блоками)
   - Блок должен переместиться в новую позицию

3. **Зоны вставки**:
   - В начале документа (перед первым блоком)
   - Между любыми двумя блоками
   - В конце документа (после последнего блока)

4. **Undo/Redo**:
   - После перемещения блока нажмите `Ctrl+Z` (или `Cmd+Z` на Mac)
   - Блок должен вернуться на прежнее место
   - Нажмите `Ctrl+Shift+Z` (или `Cmd+Shift+Z` на Mac) для Redo
   - Блок должен снова переместиться

5. **Защищенные блоки**:
   - Блоки с `protected: true` не должны быть перетаскиваемыми
   - (В тестовом документе все блоки доступны для перетаскивания)

### Ожидаемое поведение:

- ✅ Блоки можно перетаскивать
- ✅ Визуальные индикаторы показывают зоны вставки
- ✅ Порядок блоков обновляется в Document
- ✅ Перемещение поддерживает undo/redo
- ✅ После перемещения документ перерендеривается корректно

## Тестирование Inline-форматирования

### Горячие клавиши:

1. **Bold (жирный)**: `Ctrl+B` (или `Cmd+B` на Mac)
   - Выделите текст
   - Нажмите `Ctrl+B`
   - Текст должен стать жирным

2. **Italic (курсив)**: `Ctrl+I` (или `Cmd+I` на Mac)
   - Выделите текст
   - Нажмите `Ctrl+I`
   - Текст должен стать курсивом

3. **Underline (подчеркивание)**: `Ctrl+U` (или `Cmd+U` на Mac)
   - Выделите текст
   - Нажмите `Ctrl+U`
   - Текст должен стать подчеркнутым

4. **Strike (зачеркивание)**: `Ctrl+Shift+S` (или `Cmd+Shift+S` на Mac)
   - Выделите текст
   - Нажмите `Ctrl+Shift+S`
   - Текст должен стать зачеркнутым

5. **Code (inline код)**: `Ctrl+Shift+K` (или `Cmd+Shift+K` на Mac)
   - Выделите текст
   - Нажмите `Ctrl+Shift+K`
   - Текст должен стать моноширинным (inline код)

### Markdown shortcuts:

1. **Bold**: Введите `**текст**` и нажмите пробел
   - Текст должен стать жирным

2. **Italic**: Введите `*текст*` и нажмите пробел
   - Текст должен стать курсивом

### Автолинкинг URL:

- Введите URL (например, `https://example.com`)
- Подождите 500мс
- URL должен автоматически стать ссылкой

### Сохранение форматирования:

- Отредактируйте текст с форматированием
- Переключитесь на другой блок (кликните вне блока)
- Форматирование должно сохраниться в Document

## Тестирование Clipboard (копирование/вставка)

### Что проверить:

1. **Выделение блоков**:
   - Кликните на любой блок - он должен выделиться (синий фон, левая граница)
   - Кликните на другой блок - предыдущий должен сняться с выделения, новый выделится
   - `Ctrl+Click` (или `Cmd+Click` на Mac) - добавляет блок к выделению
   - Можно выделить несколько блоков

2. **Копирование блоков**:
   - Выделите один или несколько блоков (клик или Ctrl+Click)
   - Нажмите `Ctrl+C` (или `Cmd+C` на Mac)
   - Блоки должны скопироваться в буфер обмена
   - В консоли должно появиться событие `blocks:copied`

3. **Вставка блоков**:
   - Скопируйте блоки (см. выше)
   - Выделите блок, после которого нужно вставить (или не выделяйте ничего для вставки в конец)
   - Нажмите `Ctrl+V` (или `Cmd+V` на Mac)
   - Блоки должны вставиться после выбранного блока или в конец документа
   - Вставленные блоки должны автоматически выделиться
   - В консоли должно появиться событие `blocks:pasted`

4. **Undo/Redo**:
   - После вставки нажмите `Ctrl+Z` (или `Cmd+Z` на Mac)
   - Вставленные блоки должны удалиться
   - Нажмите `Ctrl+Shift+Z` (или `Cmd+Shift+Z` на Mac) для Redo
   - Блоки должны вернуться

5. **Совместимость с текстовым редактированием**:
   - Кликните в текстовый блок и начните редактировать
   - `Ctrl+C` и `Ctrl+V` должны работать как стандартное копирование/вставка текста
   - Не должны перехватываться обработчиками блоков

### Ожидаемое поведение:

- ✅ Блоки можно выделять кликом
- ✅ Множественное выделение через Ctrl+Click
- ✅ Копирование выбранных блоков через Ctrl+C
- ✅ Вставка блоков через Ctrl+V
- ✅ Вставка поддерживает undo/redo
- ✅ Не мешает стандартному копированию/вставке текста

## Запуск автоматических тестов

```bash
# Откройте в браузере
http://localhost:5173/testrunner.html
```

Все тесты должны пройти успешно (зеленые галочки).

## Отладка

### Консоль браузера

Откройте DevTools (F12) и проверьте консоль на наличие ошибок.

### События

Приложение логирует события в консоль:
- `Editor initialized` - редактор инициализирован
- `Document loaded: [название]` - документ загружен
- `block:drag-start` - начало перетаскивания блока
- `block:drag-end` - окончание перетаскивания блока
- `block:moved` - блок перемещен

### Проверка состояния Document

В консоли браузера:
```javascript
// Получить редактор
const app = window.__editor; // если сохранен глобально

// Или через событие
eventBus.on('document:loaded', ({ document }) => {
    console.log('Document blocks:', document.blocks);
});
```

## Известные проблемы

Если что-то не работает:

1. **Блоки не перетаскиваются**:
   - Проверьте, что блоки не защищены (`protected: false`)
   - Убедитесь, что `_setupDragAndDrop()` вызывается после рендеринга

2. **Drop zones не показываются**:
   - Проверьте стили `.drop-zone-indicator` в `main.css`
   - Убедитесь, что класс `drop-zone-active` добавляется при drag over

3. **Форматирование не сохраняется**:
   - Проверьте, что событие `textblock:content-changed` эмитится
   - Убедитесь, что `updateBlock()` вызывается в EditorCore

